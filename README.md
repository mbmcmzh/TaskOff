# TaskOff - Windows 定时关机自动化工具

一个使用 Python + PyQt5 开发的 Windows 定时关机工具，支持在关机前执行自动化操作序列。

## 功能特性

- ⏰ **定时关机**: 设置倒计时，到时自动关机
- 🤖 **自动化操作**: 关机前可执行鼠标点击、键盘输入等自动化操作
- 🖱️ **鼠标操作**: 点击、双击、右键、移动、拖拽、滚轮
- ⌨️ **键盘操作**: 文本输入、按键、组合键
- ⏱️ **延迟操作**: 在操作之间添加等待时间
- 💾 **序列保存**: 将操作序列保存为 JSON 文件
- 🔔 **关机提醒**: 最后 30 秒弹窗提醒，可取消关机
- 🔲 **系统托盘**: 最小化到托盘，不占用任务栏

## 安装

### 环境要求
- Python 3.8+
- Windows 操作系统

### 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 运行程序

```bash
python main.py
```

### 设置倒计时

1. 在左侧设置小时、分钟、秒
2. 或使用快捷按钮（5分钟、15分钟、30分钟、1小时）
3. 点击"开始"按钮启动倒计时

### 添加自动化操作

1. 在右侧"自动化操作序列"区域点击"添加"
2. 选择操作类型（鼠标点击、键盘输入等）
3. 设置操作参数
4. 点击"确定"添加操作

### 捕获鼠标位置

1. 添加/编辑鼠标操作时，点击"捕获位置(F2)"
2. 将鼠标移动到目标位置
3. 按 F2 键确认捕获

### 测试操作序列

点击"测试运行"按钮，3秒后将执行操作序列（不会真正关机）

### 保存/加载操作序列

- 点击"保存"将当前序列保存为 JSON 文件
- 点击"加载"从 JSON 文件加载操作序列

## 打包为 exe

```bash
pyinstaller --onefile --windowed --name TaskOff --icon=icon.ico main.py
```

生成的 exe 文件在 `dist/` 目录下。

## 项目结构

```
TaskOff/
├── main.py                 # 程序入口
├── requirements.txt        # 依赖列表
├── README.md              # 说明文档
└── src/
    ├── core/              # 核心模块
    │   ├── scheduler.py   # 定时调度器
    │   └── shutdown.py    # 关机控制
    ├── automation/        # 自动化模块
    │   ├── mouse_control.py    # 鼠标控制
    │   ├── keyboard_control.py # 键盘控制
    │   └── executor.py    # 操作执行器
    ├── models/            # 数据模型
    │   └── action.py      # 操作动作模型
    └── ui/                # 界面模块
        └── main_window.py # 主窗口
```

## 操作类型说明

| 操作类型 | 说明 | 参数 |
|---------|------|------|
| 鼠标点击 | 单击鼠标 | x, y, 按键(左/右/中) |
| 鼠标双击 | 双击鼠标 | x, y |
| 鼠标右键 | 右键点击 | x, y |
| 鼠标移动 | 移动鼠标 | x, y, 持续时间 |
| 鼠标拖拽 | 拖拽到位置 | x, y, 持续时间 |
| 鼠标滚轮 | 滚动滚轮 | 滚动量, x, y |
| 输入文本 | 键入文字 | 文本内容 |
| 按键 | 按下按键 | 按键名称, 次数 |
| 组合键 | 按下组合键 | 按键列表(如 ctrl+c) |
| 延迟等待 | 等待指定时间 | 秒数 |

## 注意事项

1. 关机功能需要管理员权限
2. 使用 `pyautogui` 时，将鼠标快速移动到屏幕角落可以中断自动化操作
3. 建议先使用"测试运行"功能验证操作序列
4. 关机前 30 秒会弹出提醒，可以取消关机

## 许可证

MIT License
